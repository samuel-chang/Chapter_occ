---
title: "occUncertain-vigentte"
author: "Samuel Chang"
date: "3/5/2020"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{occUncertain-vigentte}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


# 1. Load the occUncertain R package and dataset
```{r}
library(occUncertain)

#To demonstrate the use of the package occUncertain we used a a small wild cat in Ecuador and Colombia, the margay (*Leopardus weidii*). The data set of 126 verified georeferenced occurrence records, includes high uncertainty above 3000 meters and NA uncertainty records. The occurrences dataset are from the Global Biodiversity Information Facility (19 May 2020) GBIF Occurrence Download https://doi.org/10.15468/dl.vk997h

load("~/GitHub/ENS Master/Chapter1/Chapter_uno/data/L_wiedii_highUnc.RData")

```

# 2. meters_to_decdeg function

The function **meters_to_decdeg** transforms the units into radian degrees for each occurence point. Its impotant to consider the fact that as one moves away from the equator towards a pole, one degree of longitude is multiplied by the cosine of the latitude, decreasing the distance, approaching zero at the pole.  

In case of having an NA values for the uncertaity, the function includes a parameter *na_action*; which enacts distance options for NA values. The options are "NA as zero" , "NA as mean", and "NA as NA".
```{r uncertainty from meter to radian degrees}
#NA as 0
L_wiedii_highUnc_naZero <-
  meters_to_decdeg(
    L_wiedii_highUnc,
    lat_col = "decimalLatitude",
    lon_col = "decimalLongitude",
    distance = "coordinateUncertaintyInMeters",
    na_action = "NA as 0"
  )

L_wiedii_highUnc_naZero <-
  cbind(L_wiedii_highUnc, L_wiedii_highUnc_naZero)

#NA as mean
L_wiedii_highUnc_naMean <-
  meters_to_decdeg(
    L_wiedii_highUnc,
    lat_col = "decimalLatitude",
    lon_col = "decimalLongitude",
    distance = "coordinateUncertaintyInMeters",
    na_action = "NA as mean"
  )

L_wiedii_highUnc_naMean <-
  cbind(L_wiedii_highUnc, L_wiedii_highUnc_naMean)

#NA as NA
L_wiedii_highUnc_naNA <-
  meters_to_decdeg(
    L_wiedii_highUnc,
    lat_col = "decimalLatitude",
    lon_col = "decimalLongitude",
    distance = "coordinateUncertaintyInMeters",
    na_action = "NA as NA"
  )
head(L_wiedii_highUnc_naNA)

L_wiedii_highUnc_naNA <-
  cbind(L_wiedii_highUnc, L_wiedii_highUnc_naNA)
head(L_wiedii_highUnc_naNA)

L_wiedii_highUnc_naNA <- dplyr::filter(L_wiedii_highUnc_naNA, !is.na(coordinateUncertaintyInMeters))
```


## Lets visualize 
```{r}
plot(L_wiedii_highUnc$decimalLongitude, L_wiedii_highUnc$decimalLatitude)
points(Leopardus_wiedii_random$lon_random, Leopardus_wiedii_random$lat_random, col = "red", pch = 21)
```

# 3 Using the random occurences in land metrics using function randon_geo_range

The Extent of Occurrence (EOO) is the area contained within the shortest continuous imaginary boundary which can be drawn to encompass all the known, inferred or projected sites of present occurrence of a taxon, excluding cases of vagrancy. (IUCN 2012)

You may want to exclude areas that are not suitable for your species when computing EOO. This is feasible using the logical argument exclude.area which will crop areas defined by the shapefile you provide with the argument country_map. Note that it is mandatory to provide a shapefile for country_map if exclude.area is TRUE. 

Area of occupancy (AOO), is the area occupied by a taxon within its extent of occurrence. The measure reflects the fact that a taxon will not usually occur throughout the area of its extent of occurrence, which may contain unsuitable or unoccupied habitats.
AOO is calculatlaed as the area of all known or predicted cells for the species. The resolution will be 2x2km as required by IUCN.

# 3. Using the random occurences in land metrics with random_geo_range
```{r geographic metrics}
library(ConR)
tictoc::tic(msg = "1000.naMean" , quiet = FALSE) #1000.naMean: 4568.72 sec elapsed
L_wiedii_high_naMean_geo_range_1000 <-
  random_geo_range(
    1000,
    L_wiedii_highUnc_naMean,
    taxa_col = "species",
    lat_col = "decimalLatitude",
    lon_col = "decimalLongitude",
    lon_uncertainty = "lon_uncertainty",
    lat_uncertainty = "lat_uncertainty"
  )
tictoc::toc()

names(L_wiedii_high_naMean_geo_range_1000)[1] <- "naMean_EOO"
names(L_wiedii_high_naMean_geo_range_1000)[2] <- "naMean_AOO"

tictoc::tic(msg = "100.naMean" , quiet = FALSE) #100.naMean: 418.96 sec elapsed
L_wiedii_high_naMean_geo_range_100 <-
  random_geo_range(
    100,
    L_wiedii_highUnc_naMean,
    taxa_col = "species",
    lat_col = "decimalLatitude",
    lon_col = "decimalLongitude",
    lon_uncertainty = "lon_uncertainty",
    lat_uncertainty = "lat_uncertainty"
  )
tictoc::toc()

names(L_wiedii_high_naMean_geo_range_100)[1] <- "naMean_EOO"
names(L_wiedii_high_naMean_geo_range_100)[2] <- "naMean_AOO"
```

```{r L_wiedii_low_naZero_geo_range}
tictoc::tic(msg = "1000.naZero" , quiet = FALSE) #1000.naZero: 4497.16 sec elapsed

L_wiedii_high_naZero_geo_range_1000 <-
  random_geo_range(
    1000,
    L_wiedii_highUnc_naZero,
    taxa_col = "species",
    lat_col = "decimalLatitude",
    lon_col = "decimalLongitude",
    lon_uncertainty = "lon_uncertainty",
    lat_uncertainty = "lat_uncertainty"
  )
tictoc::toc()
names(L_wiedii_high_naZero_geo_range_1000)[1] <- "naZero_EOO"
names(L_wiedii_high_naZero_geo_range_1000)[2] <- "naZero_AOO"

tictoc::tic(msg = "100.naZero" , quiet = FALSE) #100.naZero: 444.04 sec elapsedy
L_wiedii_high_naZero_geo_range_100 <-
  random_geo_range(
    100,
    L_wiedii_highUnc_naZero,
    taxa_col = "species",
    lat_col = "decimalLatitude",
    lon_col = "decimalLongitude",
    lon_uncertainty = "lon_uncertainty",
    lat_uncertainty = "lat_uncertainty"
  )
tictoc::toc()
names(L_wiedii_low_naZero_geo_range_100)[1] <- "naZero_EOO"
names(L_wiedii_low_naZero_geo_range_100)[2] <- "naZero_AOO"
```

```{r L_wiedii_low_naNA_geo_range}
library(tictoc)
tictoc::tic(msg = "1000.naNA", quiet = FALSE)
L_wiedii_high_naNA_geo_range_1000 <-
  random_geo_range(
    1000,
    L_wiedii_highUnc_naNA,
    taxa_col = "species",
    lat_col = "decimalLatitude",
    lon_col = "decimalLongitude",
    lon_uncertainty = "lon_uncertainty",
    lat_uncertainty = "lat_uncertainty"
  )
tictoc::toc()

names(L_wiedii_high_naNA_geo_range_1000)[1] <- "naNA_EOO"
names(L_wiedii_high_naNA_geo_range_1000)[2] <- "naNA_AOO"

library(tictoc)
tictoc::tic(msg = "100.naNA", quiet = FALSE)   #443.32 sec elapsed
L_wiedii_high_naNA_geo_range_100 <- L_wiedii_low_naNA_geo_range_1000 <-
  random_geo_range(
    100,
    L_wiedii_highUnc_naNA,
    taxa_col = "species",
    lat_col = "decimalLatitude",
    lon_col = "decimalLongitude",
    lon_uncertainty = "lon_uncertainty",
    lat_uncertainty = "lat_uncertainty"
  )
tictoc::toc()

names(L_wiedii_high_naNA_geo_range_100)[1] <- "naNA_EOO"
names(L_wiedii_high_naNA_geo_range_100)[2] <- "naNA_AOO"
```

```{r csv iterations}

L_wiedii_high_100georanges <-
  cbind(
    L_wiedii_high_naMean_geo_range_100,
    L_wiedii_high_naZero_geo_range_100,
    L_wiedii_high_naNA_geo_range_100
  )
write.csv(L_wiedii_high_100georanges, "../Results/L_wiedii_high_100georanges.csv")

L_wiedii_high_1000georanges <-
  cbind(
    L_wiedii_high_naMean_geo_range_1000,
    L_wiedii_high_naZero_geo_range_1000,
    L_wiedii_high_naNA_geo_range_1000
  )
write.csv(L_wiedii_high_1000georanges, "../Results/L_wiedii_high_1000georanges.csv" )
```
