---
title: "occUncertain-vigentte"
author: "Samuel Chang"
date: "3/5/2020"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{occUncertain-vigentte}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


# 1. Load the occUncertain R package and dataset
```{r}
library(occUncertain)

#To demonstrate the use of the package occUncertain we used a a small wild cat in Ecuador and Colombia, the margay (*Leopardus weidii*). The data set of 126 verified georeferenced occurrence records, includes low uncertainty below 3000 meters and NA uncertainty records. The occurrences dataset are from the Global Biodiversity Information Facility (19 May 2020) GBIF Occurrence Download https://doi.org/10.15468/dl.s7tq24

load("../data/L_wiedii_lowUnc.RData")

```

# 2. meters_to_decdeg function

The function **meters_to_decdeg** transforms the units into radian degrees for each occurence point. Its impotant to consider the fact that as one moves away from the equator towards a pole, one degree of longitude is multiplied by the cosine of the latitude, decreasing the distance, approaching zero at the pole.  

In case of having an NA values for the uncertaity, the function includes a parameter *na_action*; which enacts distance options for NA values. The options are "NA as zero" , "NA as mean", and "NA as NA".

```{r uncertainty from meter to radian degrees}
#NA as 0
L_wiedii_lowUnc_naZero <-
  meters_to_decdeg(
    L_wiedii_lowUnc,
    lat_col = "decimalLatitude",
    lon_col = "decimalLongitude",
    distance = "coordinateUncertaintyInMeters",
    na_action = "NA as 0"
  )
head(L_wiedii_lowUnc_naZero)


L_wiedii_lowUnc_naZero <-
  cbind(L_wiedii_lowUnc, L_wiedii_lowUnc_naZero)
head(L_wiedii_lowUnc_naZero)

#NA as mean
L_wiedii_lowUnc_naMean <-
  meters_to_decdeg(
    L_wiedii_lowUnc,
    lat_col = "decimalLatitude",
    lon_col = "decimalLongitude",
    distance = "coordinateUncertaintyInMeters",
    na_action = "NA as mean"
  )
head(L_wiedii_lowUnc_naMean)


L_wiedii_lowUnc_naMean <-
  cbind(L_wiedii_lowUnc, L_wiedii_lowUnc_naMean)
head(L_wiedii_lowUnc_naMean)

#NA as NA
L_wiedii_lowUnc_naNA <-
  meters_to_decdeg(
    L_wiedii_lowUnc,
    lat_col = "decimalLatitude",
    lon_col = "decimalLongitude",
    distance = "coordinateUncertaintyInMeters",
    na_action = "NA as NA"
  )
head(L_wiedii_lowUnc_naNA)


L_wiedii_lowUnc_naNA <-
  cbind(L_wiedii_lowUnc, L_wiedii_lowUnc_naNA)
head(L_wiedii_lowUnc_naNA)

L_wiedii_lowUnc_naNA <- dplyr::filter(L_wiedii_lowUnc_naNA, !is.na(coordinateUncertaintyInMeters))
```

# 3. Using the random occurences in land metrics with random_geo_range
```{r geographic metrics}
library(ConR)
tictoc::tic(msg = "1000.naMean" , quiet = FALSE) #1000.naMean: 4568.72 sec elapsed
L_wiedii_low_naMean_geo_range_1000 <-
  random_geo_range(
    1000,
    L_wiedii_lowUnc_naMean,
    taxa_col = "species",
    lat_col = "decimalLatitude",
    lon_col = "decimalLongitude",
    lon_uncertainty = "lon_uncertainty",
    lat_uncertainty = "lat_uncertainty"
  )
tictoc::toc()

names(L_wiedii_low_naMean_geo_range_1000)[1] <- "naMean_EOO"
names(L_wiedii_low_naMean_geo_range_1000)[2] <- "naMean_AOO"

tictoc::tic(msg = "100.naMean" , quiet = FALSE) #100.naMean: 418.96 sec elapsed
L_wiedii_low_naMean_geo_range_100 <-
  random_geo_range(
    100,
    L_wiedii_lowUnc_naMean,
    taxa_col = "species",
    lat_col = "decimalLatitude",
    lon_col = "decimalLongitude",
    lon_uncertainty = "lon_uncertainty",
    lat_uncertainty = "lat_uncertainty"
  )
tictoc::toc()

names(L_wiedii_low_naMean_geo_range_100)[1] <- "naMean_EOO"
names(L_wiedii_low_naMean_geo_range_100)[2] <- "naMean_AOO"
```

```{r L_wiedii_low_naZero_geo_range}
tictoc::tic(msg = "1000.naZero" , quiet = FALSE) #1000.naZero: 4497.16 sec elapsed

L_wiedii_low_naZero_geo_range_1000 <-
  random_geo_range(
    1000,
    L_wiedii_lowUnc_naZero,
    taxa_col = "species",
    lat_col = "decimalLatitude",
    lon_col = "decimalLongitude",
    lon_uncertainty = "lon_uncertainty",
    lat_uncertainty = "lat_uncertainty"
  )
tictoc::toc()
names(L_wiedii_low_naZero_geo_range_1000)[1] <- "naZero_EOO"
names(L_wiedii_low_naZero_geo_range_1000)[2] <- "naZero_AOO"

tictoc::tic(msg = "100.naZero" , quiet = FALSE) #100.naZero: 444.04 sec elapsedy
L_wiedii_low_naZero_geo_range_100 <-
  random_geo_range(
    100,
    L_wiedii_lowUnc_naZero,
    taxa_col = "species",
    lat_col = "decimalLatitude",
    lon_col = "decimalLongitude",
    lon_uncertainty = "lon_uncertainty",
    lat_uncertainty = "lat_uncertainty"
  )
tictoc::toc()
names(L_wiedii_low_naZero_geo_range_100)[1] <- "naZero_EOO"
names(L_wiedii_low_naZero_geo_range_100)[2] <- "naZero_AOO"
```

```{r L_wiedii_low_naNA_geo_range}
library(tictoc)
tictoc::tic(msg = "1000.naNA", quiet = FALSE)
L_wiedii_low_naNA_geo_range_1000 <-
  random_geo_range(
    1000,
    L_wiedii_lowUnc_naNA,
    taxa_col = "species",
    lat_col = "decimalLatitude",
    lon_col = "decimalLongitude",
    lon_uncertainty = "lon_uncertainty",
    lat_uncertainty = "lat_uncertainty"
  )
tictoc::toc()

names(L_wiedii_low_naNA_geo_range_1000)[1] <- "naNA_EOO"
names(L_wiedii_low_naNA_geo_range_1000)[2] <- "naNA_AOO"

library(tictoc)
tictoc::tic(msg = "100.naNA", quiet = FALSE)   #443.32 sec elapsed
L_wiedii_low_naNA_geo_range_100 <- L_wiedii_low_naNA_geo_range_1000 <-
  random_geo_range(
    100,
    L_wiedii_lowUnc_naNA,
    taxa_col = "species",
    lat_col = "decimalLatitude",
    lon_col = "decimalLongitude",
    lon_uncertainty = "lon_uncertainty",
    lat_uncertainty = "lat_uncertainty"
  )
tictoc::toc()

names(L_wiedii_low_naNA_geo_range_100)[1] <- "naNA_EOO"
names(L_wiedii_low_naNA_geo_range_100)[2] <- "naNA_AOO"
```

```{r csv iterations}

L_wiedii_low_100georanges <-
  cbind(
    L_wiedii_low_naMean_geo_range_100,
    L_wiedii_low_naZero_geo_range_100,
    L_wiedii_low_naNA_geo_range_100
  )
write.csv(L_wiedii_low_100georanges, "~/GitHub/ENS Master/Chapter1/Chapter_uno/Results/L_wiedii_low_100georanges.csv")

L_wiedii_low_1000georanges <-
  cbind(
    L_wiedii_low_naMean_geo_range_1000,
    L_wiedii_low_naZero_geo_range_1000,
    L_wiedii_low_naNA_geo_range_1000
  )
write.csv(L_wiedii_low_1000georanges, "../Results/L_wiedii_low_1000georanges.csv" )
```


