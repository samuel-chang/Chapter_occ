---
title: "occUncertain-vigentte"
author: "Samuel Chang"
date: "3/5/2020"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{occUncertain-vigentte}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# 1. Load package and dataset 
```{r}
library(occUncertain)

#To demonstrate the use of the package occUncertain we used a set of four different datasets. This dataset is for 1480 georeferenced occurrence records in Colombiafor the spectacled bear (*Tremarctos ornatus*). These occurrences dataset are from the Global Biodiversity Information Facility (19 May 2020) GBIF Occurrence Download https://doi.org/10.15468/dl.6ykjg7

load("../data/T_ornatus_CO.RData")
```

# 2. meters_to_decdeg function
```{r uncertainty from meter to radian degrees }
#NA as 0
T_ornatus_CO_uncertainty_naZero <-
  meters_to_decdeg(
    T_ornatus_CO,
    lat_col = "decimalLatitude",
    lon_col = "decimalLongitude",
    distance = "coordinateUncertaintyInMeters",
    na_action = "NA as 0"
  )
head(T_ornatus_CO_uncertainty_naZero)

T_ornatus_CO_uncertainty_naZero <-
  cbind(T_ornatus_CO, T_ornatus_CO_uncertainty_naZero)
head(T_ornatus_CO_uncertainty_naZero)

#NA as Mean
T_ornatus_CO_uncertainty_naMean <- meters_to_decdeg(
  T_ornatus_CO,
  lat_col = "decimalLatitude",
  lon_col = "decimalLongitude",
  distance = "coordinateUncertaintyInMeters",
  na_action = "NA as mean"
)

T_ornatus_CO_uncertainty_naMean <-
  cbind(T_ornatus_CO, T_ornatus_CO_uncertainty_naMean)
head(T_ornatus_CO_uncertainty_naMean)

#NA as NA
T_ornatus_CO_uncertainty_naNA <-
  meters_to_decdeg(
    T_ornatus_CO,
    lat_col = "decimalLatitude",
    lon_col = "decimalLongitude",
    distance = "coordinateUncertaintyInMeters",
    na_action = "NA as NA"
  )
head(T_ornatus_CO_uncertainty_naNA)

T_ornatus_CO_uncertainty_naNA <-
  cbind(T_ornatus_CO, T_ornatus_CO_uncertainty_naNA)
head(T_ornatus_CO_uncertainty_naNA)

#filter occ that have NA uncertainty 
T_ornatus_CO_uncertainty_naNA <-
  dplyr::filter(T_ornatus_CO_uncertainty_naNA,
    !is.na(coordinateUncertaintyInMeters))
```

# 3 Using the random occurences in land metrics using function randon_geo_range

The Extent of Occurrence (EOO) is the area contained within the shortest continuous imaginary boundary which can be drawn to encompass all the known, inferred or projected sites of present occurrence of a taxon, excluding cases of vagrancy. (IUCN 2012)

You may want to exclude areas that are not suitable for your species when computing EOO. This is feasible using the logical argument exclude.area which will crop areas defined by the shapefile you provide with the argument country_map. Note that it is mandatory to provide a shapefile for country_map if exclude.area is TRUE. 

Area of occupancy (AOO), is the area occupied by a taxon within its extent of occurrence. The measure reflects the fact that a taxon will not usually occur throughout the area of its extent of occurrence, which may contain unsuitable or unoccupied habitats.
AOO is calculatlaed as the area of all known or predicted cells for the species. The resolution will be 2x2km as required by IUCN.

```{r land metrics}
T_ornatus_CO_naMean_geo_range_100 <-
  random_geo_range(
    100,
    T_ornatus_CO_uncertainty_naMean,
    lat_col = "decimalLatitude",
    lon_col = "decimalLongitude",
    lat_uncertainty = "lat_uncertainty",
    lon_uncertainty = "lon_uncertainty",
  )
names(T_ornatus_CO_naMean_geo_range_100)[1] <- "naMean_EOO"
names(T_ornatus_CO_naMean_geo_range_100)[2] <- "naMean_AOO"

tictoc::tic(msg = "naMean_geo_range_1000", quiet =FALSE ) #5443.87 sec elapsed
T_ornatus_CO_naMean_geo_range_1000 <-
  random_geo_range(
    1000,
    T_ornatus_CO_uncertainty_naMean,
    lat_col = "decimalLatitude",
    lon_col = "decimalLongitude",
    lat_uncertainty = "lat_uncertainty",
    lon_uncertainty = "lon_uncertainty",
  )
tictoc::toc()
names(T_ornatus_CO_naMean_geo_range_1000)[1] <- "naMean_EOO"
names(T_ornatus_CO_naMean_geo_range_1000)[2] <- "naMean_AOO"
```

```{r }
tictoc::tic(msg = "naZero_geo_range_100", quiet =FALSE ) #526.59 sec elapsed
T_ornatus_CO_naZero_geo_range_100 <-
  random_geo_range(
    100,
    T_ornatus_CO_uncertainty_naZero,
    lat_col = "decimalLatitude",
    lon_col = "decimalLongitude",
    lat_uncertainty = "lat_uncertainty",
    lon_uncertainty = "lon_uncertainty",
  )

tictoc::toc()
names(T_ornatus_CO_naZero_geo_range_100)[1] <- "naZero_EOO"
names(T_ornatus_CO_naZero_geo_range_100)[2] <- "naZero_AOO"

tictoc::tic(msg = "naZero_geo_range_1000", quiet =FALSE ) #5413.85 sec elapsed
T_ornatus_CO_naZero_geo_range_1000 <-
  random_geo_range(
    1000,
    T_ornatus_CO_uncertainty_naZero,
    lat_col = "decimalLatitude",
    lon_col = "decimalLongitude",
    lat_uncertainty = "lat_uncertainty",
    lon_uncertainty = "lon_uncertainty",
  )
tictoc::toc()
names(T_ornatus_CO_naZero_geo_range_1000)[1] <- "naZero_EOO"
names(T_ornatus_CO_naZero_geo_range_1000)[2] <- "naZero_AOO"
```

```{r naNA_geo_range}
T_ornatus_CO_naNA_geo_range_100 <-
  random_geo_range(
    100,
    T_ornatus_CO_uncertainty_naNA,
    lat_col = "decimalLatitude",
    lon_col = "decimalLongitude",
    lat_uncertainty = "lat_uncertainty",
    lon_uncertainty = "lon_uncertainty",
  )
names(T_ornatus_CO_naNA_geo_range_100)[1] <- "naNA_EOO"
names(T_ornatus_CO_naNA_geo_range_100)[2] <- "naNA_AOO"

T_ornatus_CO_naNA_geo_range_1000 <-
  random_geo_range(
    1000,
    T_ornatus_CO_uncertainty_naNA,
    lat_col = "decimalLatitude",
    lon_col = "decimalLongitude",
    lat_uncertainty = "lat_uncertainty",
    lon_uncertainty = "lon_uncertainty",
  )
names(T_ornatus_CO_naNA_geo_range_1000)[1] <- "naNA_EOO"
names(T_ornatus_CO_naNA_geo_range_1000)[2] <- "naNA_AOO"
```

```{r save csv}
T_ornatus_CO_100georanges <-
  cbind(
    T_ornatus_CO_naMean_geo_range_100,
    T_ornatus_CO_naZero_geo_range_100,
    T_ornatus_CO_naNA_geo_range_100
  )

write.csv(T_ornatus_CO_100georanges, "C:/Users/Samuel/Documents/GitHub/ENS Master/Chapter1/Chapter_uno/Results/T_ornatus_CO_100georanges.csv" )

T_ornatus_CO_1000georanges <-
  cbind(
    T_ornatus_CO_naMean_geo_range_1000,
    T_ornatus_CO_naZero_geo_range_1000,
    T_ornatus_CO_naNA_geo_range_1000
  )

write.csv(T_ornatus_CO_1000georanges, "C:/Users/Samuel/Documents/GitHub/ENS Master/Chapter1/Chapter_uno//Results/T_ornatus_CO_1000georanges.csv")